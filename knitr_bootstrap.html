<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- jQuery -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.2/css/smoothness/jquery-ui-1.10.2.custom.min.css">

<!-- highlight.js -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/github.min.css" media="screen">

<!-- bootstrap -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" media="screen">

<!-- bootstrap-responsive -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap-responsive.min.js"></script>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/css/bootstrap.min.css" media="screen">

<!-- tocify -->
<script src="http://gregfranko.com/jquery.tocify.js/js/jquery.tocify.min.js"></script>
<link rel="stylesheet" href="http://gregfranko.com/jquery.tocify.js/css/jquery.tocify.css">

<!-- fancybox -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.js"></script>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css">

<script>

/* run scripts when document is ready */
$(function() {

  /* find all code blocks which have a class and add toggle */
  $('pre code[class]').each(function(i, e) {
    $(this).parent()
      .before('<button class="btn-mini toggle btn-link">+/- '
        + $(this).attr('class') + ' Code</button>');
  });

  /* Add toggle to output blocks and do not syntax highlight */
  $('pre code').not('[class]').addClass('no-highlight')
    .parent().before('<button class="btn-mini toggle btn-link">+/- Output</button>');

  /* syntax highlight code blocks*/
  hljs.initHighlighting();

  /* onclick toggle next code block */
  $('.toggle').click(function() {
    $(this).next('pre').slideToggle();
  });

  /* hide by default if a perl or python script code block */
  <!--$('code.perl,code.python').parent().hide();-->

  /* give images a fancybox and thumbnail classes to allow lightbox and thumbnails TODO: make fancybox prev next if grouped */
  $('p').each(function(){
    $(this).children('img').unwrap().wrapAll('<ul class="thumbnails" />').wrap('<li class="span4"><a href="#", class="thumbnail"></a></li>').addClass('fancybox');
  });

  /* fancybox */
  $(".fancybox").each( function() {
    var img = $(this);
    $(this).fancybox({
      beforeLoad: function(){
        <!--img.removeClass('thumbnail');-->
      },
      afterClose: function(){
        <!--img.addClass('thumbnail');-->
        img.css('display', 'block');
      },
    });
  });

  /* add bootstrap classes */
  $('body').wrapInner('<div class="container-fluid"><div class="row-fluid"><div class="span9">');
  $('.row-fluid').prepend('<div class="span3"><div id="toc"></div></div>');

  /* add navbar */
  $('.container-fluid').prepend(
'<div class="navbar-fixed-bottom navbar">\
  <div class="navbar-inner">\
    <ul class="nav pull-right">\
      <li><a href="#" id="toggle_code">Toggle Code</a></li>\
      <li><a href="#" id="toggle_output">Toggle Output</a></li>\
      <li><a href="#" id="toggle_plot">Toggle Plots</a></li>\
    </ul>\
  </div>\
</div>'
);

  /* global toggles FIXME explicitly toggle all on/off using global variables */
  $('#toggle_code').click(function(){
    $('pre code[class!=no-highlight]').parent().slideToggle();
    return false;
  });
  $('#toggle_output').click(function(){
    $('pre code[class=no-highlight]').parent().slideToggle();
    return false;
  });
  $('#toggle_plot').click(function(){
    $('img').closest('li').slideToggle();
    return false;
  });

  /* add table of contents */
  $('#toc').tocify({'selectors' : 'h1,h2,h3,h4', extendPage: false});

  /* style tables */
  $('table').addClass('table table-striped table-bordered table-hover table-condensed')
    .wrap('<div style="overflow: auto"/>');

  /* add footer */
  $('body').wrapInner('<div id="wrap" />');
  $('body').append('<div id="push" />');
  var p = $('p:contains("Author:")');
  var last_p = p.filter(':last');
  p.detach();
  last_p.appendTo("body");
  last_p.addClass('muted').attr('id','credit');
  last_p.wrap('<div id="footer"><div class="container" /></div>');
});
</script>
